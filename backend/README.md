# Envelope Management API

This document outlines the endpoints and schema for the Envelope Management API, which is used to manage and retrieve information about envelopes, their activation statuses, obligations, scores, reminders, and more.

---

## **API Endpoints**

### **1. Get Activation Status**

- **Endpoint**: `/getActivationStatus`
- **Method**: `GET`
- **Description**: Returns the activation status of the envelope or room.
- **Response**:
  ```json
  {
    "isActivated": true
  }
  ```

### **2. Activate Envelope**

- **Endpoint**: `/activateEnvelope`
- **Method**: `POST`
- **Description**: Activates an envelope.
- **Response**: None (HTTP 200 on success).

### **3. Deactivate Envelope**

- **Endpoint**: `/deactivateEnvelope`
- **Method**: `POST`
- **Description**: Deactivates an envelope.
- **Response**: None (HTTP 200 on success).

### **4. Get Score**

- **Endpoint**: `/{envelopeId}/getScore`
- **Method**: `GET`
- **Description**: Retrieves the obligatory score for the specified envelope.
- **Response**:
  ```json
  {
    "obligatoryScore": 95.32
  }
  ```

### **5. Get Obligations**

- **Endpoint**: `/{envelopeId}/getObligations`
- **Method**: `GET`
- **Description**: Retrieves a list of keys and obligations for the specified envelope.
- **Response**:
  ```json
  {
    "obligations": ["Obligation1", "Obligation2", "Obligation3"]
  }
  ```

### **6. Get CTA Reminders**

- **Endpoint**: `/{envelopeId}/getCTAReminders`
- **Method**: `GET`
- **Description**: Retrieves a list of CTA (Call-to-Action) reminders for the specified envelope.
- **Response**:
  ```json
  [
    {
      "cta": "Submit Document",
      "date": "2025-01-01T10:00:00Z",
      "recur": "weekly"
    },
    {
      "cta": "Review Contract",
      "date": "2025-01-08T10:00:00Z",
      "recur": "none"
    }
  ]
  ```

### **7. Chat with Envelope**

- **Endpoint**: `/chat/{envelopeId}`
- **Method**: `POST`
- **Description**: Sends a prompt related to the specified envelope.
- **Request Body**:
  ```json
  {
    "prompt": "Your query or instruction related to the envelope."
  }
  ```
- **Response**:
  ```json
  {
    "response": "Response generated by the chat system."
  }
  ```

---

## **Schema**

### **Envelope Object**

The envelope object holds key details about an envelope.

```json
{
  "envelopeId": "UUID",
  "isActivated": true,
  "senderId": "UUID",
  "recipients_emails": ["example1@example.com", "example2@example.com"],
  "obligatoryScore": 95.32,
  "obligations": ["Obligation1", "Obligation2"],
  "CTAReminders": [
    {
      "cta": "Submit Document",
      "date": "2025-01-01T10:00:00Z",
      "recur": "weekly"
    }
  ],
  "signedOn": "2025-01-01T10:00:00Z",
  "agreements": ["/path/to/agreement1", "/path/to/agreement2"]
}
```

### **Fields**

- **`envelopeId`**: Unique identifier for the envelope (UUID).
- **`isActivated`**: Boolean indicating whether the envelope is activated.
- **`senderId`**: Unique identifier for the sender (UUID, typically from DocuSign).
- **`recipients_emails`**: Array of recipient email addresses.
- **`obligatoryScore`**: Float (up to two decimals) representing the score of obligations.
- **`obligations`**: Array of strings listing obligations.
- **`CTAReminders`**: Array of objects containing:
  - `cta` (string): The call-to-action message.
  - `date` (Date): When the action is due.
  - `recur` (string): Recurrence type (e.g., "none", "daily", "weekly").
- **`signedOn`**: Date the envelope was signed.
- **`agreements`**: Array of strings storing relative paths to agreements.

---

## **Webhook and Cron Job**

### **Webhook Listener**

- **Purpose**: Listens to external events related to envelopes and processes updates.
- **Integration**: Use a cron job to periodically poll the webhook and ensure timely updates.
- **Example Usage**:
  - Update the activation status of an envelope.
  - Refresh CTA reminders based on webhook payloads.

---

## **Notes**

- Ensure UUIDs conform to standard UUID format.
- All dates should be in ISO 8601 format (e.g., `2025-01-01T10:00:00Z`).
- API responses follow strict JSON formatting with descriptive fields.
